% TSLOADEXPERIMENT   Load an experiment from the .mat file%   TSLOADEXPERIMENT(FILENAME) loads in the file FILENAME as an experiment.%   %   FILENAME must be a .mat file created by TSsaveexperiment.%%	See also TSSAVEEXPERIMENT, TSLOADSESSIONS, TSUNPACKCODESfunction [result] = TSloadexperiment(filename)result = 0;if evalin('base','~isempty(who(''global'',''Experiment''))')             % Examines current base for global variable 'Experiment'    button = questdlg('An experiment structure already exists. Would you like to overwrite it?','TSloadexperiment','No','Yes','Yes');    if ~strcmp(button,'Yes')        result=1;        return;    else clear global Experiment;    endend;if nargin == 0	[filename, pathname] = uigetfile('*.mat', 'Find the Experiment .mat file');	filename = [pathname filename];    if (isequal(filename,0) || isequal(pathname,0))        return;    endendif exist(filename,'file') || exist([filename '.mat'],'file')     evalin('base',['load(''' filename ''')']);  else    fprintf('There is no file named %s in the current directory',filename);    return;end;%disp(['load(''' filename ''')']);evalin('base','global Experiment');evalin('base','TSdeclareeventcodes');changedflag = false;global Experiment;if ~ismember('OverWriteMode',fields(Experiment.Info))    % Overwritemode flag (default is false)    Experiment.Info.OverWriteMode = false;    changedflag = true;    end;if ~ismember('FilesLoaded',fields(Experiment.Info))    % Files Loaded    Experiment.Info.FilesLoaded = {};    changedflag = true;end;if changedflag == true    evalin('base',['TSsaveexperiment(''' filename ''')']);end;Experiment.NumSubjects = length(Experiment.Subject);if isfield(Experiment.Subject,'Sessions')    for S = 1:Experiment.NumSubjects        Experiment.Subject(S).NumSessions = size(Experiment.Subject(S).Session,2);    endendFN = fieldnames(Experiment);if strcmp('none',Experiment.Info.ActiveTrialType) && length(FN)>13    % there should always be at least 13 fields preceding the first trial    % definition in the Experiment structure, because there are that many    % fields specified at the Experiment level when the structure is first    % created    FN = fieldnames(Experiment);    for fn = 14:length(FN)        if (length(FN{fn})>5) && strcmp('Trial',FN{fn}(1:5))            str=char({'';'Warning: Experiment.Info.ActiveTrialType says ''none''';...                'BUT at least one trial type has been defined.';...                'When at least one trial type has been defined,';...                'an active trial type must be specified in the';...                'Experiment.Info.ActiveTrialType field. Use TSsettrial';...                'to specify an active trial type before doing any analysis';''})        end    end    endresult = 1;